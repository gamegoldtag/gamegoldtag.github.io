<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="PR diff 파싱하고 AI 코드 리뷰 자동화. GitHub Actions 통합, 비용 최적화">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://ikakao.kr/posts/post-32.html">
  <title>Claude API로 코드 리뷰 자동화 만들기 | Goldtag</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.min.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2446729462046987"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/gowun-batang@5.0.20/700.css">
  <link rel="stylesheet" href="/style.css">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "Claude API로 코드 리뷰 자동화 만들기",
    "author": { "@type": "Person", "name": "ian.lab" },
    "publisher": { "@type": "Person", "name": "ian.lab" },
    "datePublished": "2025-07-04",
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://ikakao.kr/posts/post-32.html" }
  }
  </script>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a class="logo" href="/">Gold<span>tag</span></a>
      <nav class="nav-links" aria-label="주요 메뉴">
        <a href="/">홈</a>
        <a href="/archive.html">전체 글</a>
        <a href="/about.html">소개</a>
        <a href="/contact.html">연락처</a>
      </nav>
    </div>
  </header>

  <div class="container-narrow">
    <nav class="breadcrumb" aria-label="경로">
      <a href="/">홈</a><span class="sep">/</span>
      <a href="/archive.html">AI &amp; 개발 도구</a><span class="sep">/</span>
      <span>현재 글</span>
    </nav>
  </div>

  <main class="post-wrap">
    <article class="post-card">
<h1>Claude API로 코드 리뷰 자동화 만들기</h1>
      <p class="meta">게시일: 2025년 7월 4일 · 16분 읽기</p>

<h2>시니어 리뷰어가 부족할 때</h2>

<p>우리 팀은 PR은 많고 시니어 리뷰어는 적었다. 결국 리뷰 대기열이 길어졌고, 간단한 버그도 머지까지 하루 이상 걸렸다. 그래서 Claude API로 1차 리뷰 봇을 만들었다.</p>

<p>중요한 원칙은 "AI가 승인하지 않는다"였다. AI는 위험 신호를 먼저 찾고, 사람 리뷰어가 최종 판단한다. 이 구조로 바꾸자 리뷰 리드타임이 줄고, 기초 실수(널 처리, 에러 누락, 로깅 누락) 발견률이 올라갔다.</p>

<h3>시스템 아키텍처</h3>

<pre><code>GitHub pull_request 이벤트
  -&gt; Actions에서 diff 추출
  -&gt; 파일 확장자/변경량 기반 필터링
  -&gt; Claude API에 리뷰 프롬프트 전달
  -&gt; 위험도(High/Medium/Low)로 정리된 코멘트 생성
  -&gt; PR 코멘트 작성 + 체크 결과 아티팩트 저장
</code></pre>

<h3>Workflow 예시</h3>

<pre><code># .github/workflows/ai-review.yml
name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Build diff file
        run: |
          git fetch origin ${{ github.base_ref }} --depth=1
          git diff --unified=2 origin/${{ github.base_ref }}...HEAD &gt; pr.diff
          echo "Diff size: $(wc -c &lt; pr.diff) bytes"

      - name: Run AI review
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          python scripts/ai_review.py --diff-file pr.diff --title "$PR_TITLE" --body "$PR_BODY"

      - name: Comment to PR
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const body = fs.readFileSync('ai-review.md', 'utf8');
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body
            });
</code></pre>

<h3>리뷰 스크립트 핵심</h3>

<pre><code>#!/usr/bin/env python3
import argparse
from anthropic import Anthropic

SYSTEM = """
너는 시니어 코드 리뷰어다.
1) 동작 버그
2) 보안 이슈
3) 성능/동시성 리스크
4) 테스트 누락
만 지적하고, 취향 논쟁은 하지 마라.
"""

def build_prompt(title: str, body: str, diff: str) -&gt; str:
    return f"""
PR 제목: {title}
PR 설명: {body}

아래 diff를 검토하고, 심각도(High/Medium/Low)와 근거를 포함해 작성해줘.
가능하면 수정 예시를 짧게 제시해줘.

{diff}
"""

def main():
    ap = argparse.ArgumentParser()
    ap.add_argument("--diff-file", required=True)
    ap.add_argument("--title", default="")
    ap.add_argument("--body", default="")
    args = ap.parse_args()

    diff = open(args.diff_file, "r", encoding="utf-8").read()
    client = Anthropic()
    msg = client.messages.create(
        model="claude-sonnet-4-5",
        max_tokens=1200,
        system=SYSTEM,
        messages=[{"role": "user", "content": build_prompt(args.title, args.body, diff)}],
    )

    text = msg.content[0].text
    with open("ai-review.md", "w", encoding="utf-8") as f:
        f.write("## AI 1차 리뷰 결과\n\n")
        f.write(text)

if __name__ == "__main__":
    main()
</code></pre>

<h3>프롬프트 설계에서 중요했던 점</h3>

<ul>
<li>스타일/취향 코멘트 제외: 노이즈를 줄여 신뢰도 확보</li>
<li>심각도 강제: 팀이 우선순위를 바로 판단 가능</li>
<li>근거/재현 조건 요구: "왜 문제인지"를 명확히 남김</li>
<li>파일 경로 + 라인 맥락 포함: 리뷰어가 즉시 확인 가능</li>
</ul>

<p>처음에는 "전체 품질 피드백" 프롬프트를 썼는데, 결과가 길고 추상적이었다. 버그/보안/성능/테스트 4가지로 좁히니 리뷰 품질이 안정됐다.</p>

<h3>운영하면서 생긴 문제와 해결</h3>

<h4>1) 큰 PR에서 비용 급증</h4>
<p>해결: diff 800줄 초과 시 파일별 분할 리뷰로 전환하고, 문서/락파일은 제외했다.</p>

<h4>2) 거짓 양성(false positive)</h4>
<p>해결: 팀 규칙(예: 허용된 lint disable 패턴)을 시스템 프롬프트에 명시했다.</p>

<h4>3) 비밀정보 유출 우려</h4>
<p>해결: API 키/토큰 패턴 마스킹, 내부 경로 치환, 민감 파일(.env, secrets/) 사전 차단.</p>

<h3>도입 효과 (8주 운영 기준)</h3>

<table>
<tr><th>지표</th><th>도입 전</th><th>도입 후</th></tr>
<tr><td>평균 1차 코멘트 시간</td><td>3시간 10분</td><td>12분</td></tr>
<tr><td>PR 머지 리드타임</td><td>29시간</td><td>17시간</td></tr>
<tr><td>머지 후 단순 회귀 버그</td><td>주 6건</td><td>주 3건</td></tr>
</table>

<p>AI가 사람 리뷰를 대체하진 못한다. 하지만 사람 리뷰어가 중요한 판단에 집중하게 만들어 주는 건 확실했다.</p>

<h3>결론</h3>

<p>코드 리뷰 자동화의 핵심은 "정확한 범위 정의"다. AI를 만능 리뷰어로 쓰지 말고, 반복적이고 규칙 기반인 1차 검증에 제한하면 품질과 속도를 같이 잡을 수 있다.</p>

      <div class="author-box">
        <div class="author-avatar">iL</div>
        <div class="author-info">
          <strong>ian.lab</strong>
          <p>실무 개발자입니다. 현장에서 겪은 문제와 해결 과정을 기록합니다. 오류 제보는 <a href="/contact.html">연락처</a>로 보내주세요.</p>
        </div>
      </div>

      <div class="related-posts">
        <h3>관련 글 더 보기</h3>
        <div class="related-list">
        <a class="related-item" href="/posts/post-07.html">
          <span class="ri-cat">AI &amp; 개발 도구</span>
          <span class="ri-title">AI 코딩 도구 6개월 실사용 후기 — 생산성이 정말 올랐을까?</span>
        </a>
        <a class="related-item" href="/posts/post-34.html">
          <span class="ri-cat">AI &amp; 개발 도구</span>
          <span class="ri-title">AI로 레거시 코드 리팩토링하기 — 실전 프롬프트 패턴</span>
        </a>
        <a class="related-item" href="/posts/post-78.html">
          <span class="ri-cat">AI &amp; 개발 도구</span>
          <span class="ri-title">LLM 프롬프트 엔지니어링 실전 — 개발자를 위한 패턴 모음</span>
        </a>
        </div>
      </div>
    </article>
</main>

  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-links">
        <a href="/">홈</a>
        <a href="/archive.html">전체 글</a>
        <a href="/about.html">소개</a>
        <a href="/contact.html">연락처</a>
        <a href="/editorial-policy.html">운영 원칙</a>
        <a href="/privacy.html">개인정보처리방침</a>
        <a href="/terms.html">이용약관</a>
      </div>
      <div class="footer-copy">
        &copy; 2026 Goldtag. All rights reserved.<br>
        기술 정보는 실제 사용 환경에 맞게 검토 후 적용하세요.
      </div>
    </div>
  </footer>
</body>
</html>
