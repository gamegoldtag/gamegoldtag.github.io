<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="clap argument parsing, indicatif progress bars, colored output, config files, cross-platform distribution">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://ikakao.kr/posts/post-16.html">
  <title>Rust로 CLI 도구 만들기 — clap + indicatif로 쓸만한 개발자 도구 제작 | DevInsight</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.min.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2446729462046987"
    crossorigin="anonymous"></script>
  <style>
    :root { --font: "Pretendard Variable", "Pretendard", sans-serif; --ink: #1a1a2e; --muted: #6b6b7b; --bg: #f8f6f1; --card: #fff; --border: #d4d0c8; --accent: #c0392b; }
    body { margin: 0; font-family: var(--font); background: var(--bg); color: var(--ink); line-height: 1.85; }
    .wrap { max-width: 800px; margin: 0 auto; padding: 48px 20px 80px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 34px; }
    h1 { margin: 0 0 10px; font-size: 2rem; line-height: 1.35; }
    h2 { margin: 36px 0 12px; font-size: 1.25rem; border-bottom: 1px solid var(--border); padding-bottom: 6px; }
    h3 { margin: 20px 0 8px; font-size: 1.05rem; color: var(--accent); }
    p { margin: 0 0 16px; }
    ul, ol { margin: 0 0 16px 20px; }
    li { margin-bottom: 8px; }
    pre { background: #2d2d3f; color: #e6e6e6; border-radius: 10px; padding: 14px 16px; overflow-x: auto; font-size: 0.88rem; margin: 0 0 16px; }
    code { background: #eee; padding: 1px 5px; border-radius: 4px; font-size: 0.88em; }
    pre code { background: none; padding: 0; }
    .meta { color: var(--muted); font-size: 0.92rem; margin-bottom: 24px; }
    .note { background: #f3efe6; border: 1px solid var(--border); border-radius: 10px; padding: 12px 16px; margin: 16px 0; font-size: 0.95rem; }
    .back { display: inline-block; margin-top: 28px; color: var(--accent); text-decoration: none; font-weight: 700; }
    table { width: 100%; border-collapse: collapse; margin: 12px 0 16px; }
    th, td { border: 1px solid var(--border); padding: 10px; text-align: left; }
    th { background: #f3efe6; }
    blockquote { border-left: 3px solid var(--accent); margin: 16px 0; padding: 8px 16px; color: var(--muted); }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/gowun-batang@5.0.20/700.css">
  <link rel="stylesheet" href="/style.css">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "Rust로 CLI 도구 만들기 — clap + indicatif로 쓸만한 개발자 도구 제작",
    "author": { "@type": "Person", "name": "ian.lab" },
    "publisher": { "@type": "Person", "name": "ian.lab" },
    "datePublished": "2025-05-09",
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://ikakao.kr/posts/post-16.html" }
  }
  </script>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a class="logo" href="/">Dev<span>Insight</span></a>
      <nav class="nav-links" aria-label="주요 메뉴">
        <a href="/">홈</a>
        <a href="/archive.html">전체 글</a>
        <a href="/about.html">소개</a>
        <a href="/contact.html">연락처</a>
      </nav>
    </div>
  </header>

  <div class="container-narrow" style="padding:0 20px;">
    <nav class="breadcrumb" aria-label="경로">
      <a href="/">홈</a><span class="sep">/</span>
      <a href="/archive.html">Rust</a><span class="sep">/</span>
      <span>현재 글</span>
    </nav>
  </div>

  <main class="post-wrap">
    <article class="post-card">
      <h1>Rust로 CLI 도구 만들기 — clap + indicatif로 쓸만한 개발자 도구 제작</h1>
      <p class="meta">게시일: 2025년 5월 9일 · 15분 읽기</p>

<p>Python으로 만든 스크립트가 너무 느려서 Rust로 다시 만들었다. 30초→0.3초.</p>

<h3>Cargo.toml 의존성</h3>

<pre><code>[package]
name = "audio-cli"
version = "0.1.0"
edition = "2021"

[dependencies]
clap = { version = "4.4", features = ["derive"] }
indicatif = "0.17"
colored = "2.1"
anyhow = "1.0"
tokio = { version = "1", features = ["full"] }
serde = { version = "1", features = ["derive"] }
serde_json = "1"
toml = "0.8"

[[bin]]
name = "audio-cli"
path = "src/main.rs"
</code></pre>

<h3>Argument Parsing with clap</h3>

<pre><code>use clap::{Parser, Subcommand};

#[derive(Parser)]
#[command(name = "audio-cli")]
#[command(about = "오디오 처리 도구", long_about = None)]
#[command(version)]
struct Cli {
    #[command(subcommand)]
    command: Commands,

    #[arg(global = true, short, long)]
    verbose: bool,
}

#[derive(Subcommand)]
enum Commands {
    /// 오디오 파일 분석
    Analyze {
        /// 입력 파일 경로
        #[arg(short, long)]
        input: String,

        /// 상세 분석 수행
        #[arg(short, long)]
        detailed: bool,

        /// 출력 형식 (json, csv)
        #[arg(short, long, default_value = "json")]
        format: String,
    },

    /// 배치 처리
    Process {
        /// 입력 디렉토리
        #[arg(short, long)]
        input_dir: String,

        /// 출력 디렉토리
        #[arg(short, long)]
        output_dir: String,

        /// 동시 처리 수
        #[arg(short = 'j', long, default_value_t = 4)]
        jobs: usize,
    },
}

#[tokio::main]
async fn main() -> anyhow::Result&lt;()&gt; {
    let cli = Cli::parse();

    match cli.command {
        Commands::Analyze { input, detailed, format } => {
            analyze(&amp;input, detailed, &amp;format).await?;
        }
        Commands::Process { input_dir, output_dir, jobs } => {
            process_batch(&amp;input_dir, &amp;output_dir, jobs).await?;
        }
    }

    Ok(())
}
</code></pre>

<h3>Progress Bar with indicatif</h3>

<pre><code>use indicatif::{ProgressBar, ProgressStyle};
use std::time::Duration;

async fn process_batch(
    input_dir: &amp;str,
    output_dir: &amp;str,
    jobs: usize,
) -> anyhow::Result&lt;()&gt; {
    let files = std::fs::read_dir(input_dir)?
        .collect::&lt;Result&lt;Vec&lt;_&gt;, _&gt;&gt;()?;

    let pb = ProgressBar::new(files.len() as u64);
    pb.set_style(
        ProgressStyle::default_bar()
            .template("[{elapsed_precise}] {bar:40.cyan/blue} {pos}/{len} {msg}")
            .unwrap()
            .progress_chars("#&gt;-")
    );

    let mut handles = vec![];

    for file in files {
        let output_dir = output_dir.to_string();
        let pb_clone = pb.clone();

        let handle = tokio::spawn(async move {
            match process_file(file.path(), &amp;output_dir).await {
                Ok(_) => {
                    pb_clone.inc(1);
                    Ok(())
                }
                Err(e) => {
                    pb_clone.println(format!("❌ Error: {}", e));
                    Err(e)
                }
            }
        });

        handles.push(handle);

        if handles.len() &gt;= jobs {
            let _ = futures::future::join_all(handles).await;
            handles = vec![];
        }
    }

    let _ = futures::future::join_all(handles).await;
    pb.finish_with_message("✓ 처리 완료!");

    Ok(())
}
</code></pre>

<h3>Colored Output</h3>

<pre><code>use colored::*;

fn print_summary(stats: &amp;Stats) {
    println!("{}", "=== 분석 결과 ===".bold().blue());
    println!("{}: {}", "파일 수".cyan(), stats.file_count);
    println!("{}: {}", "총 크기".green(), format_size(stats.total_size));
    println!("{}: {}", "평균 품질".yellow(), stats.avg_quality);

    if stats.errors &gt; 0 {
        println!("{}: {}", "에러".red().bold(), stats.errors);
    }
}

fn format_size(bytes: u64) -> String {
    const UNITS: &amp;[&amp;str] = &amp;["B", "KB", "MB", "GB"];
    let mut size = bytes as f64;
    let mut unit_idx = 0;

    while size &gt;= 1024.0 &amp;&amp; unit_idx &lt; UNITS.len() - 1 {
        size /= 1024.0;
        unit_idx += 1;
    }

    format!("{:.2} {}", size, UNITS[unit_idx])
}
</code></pre>

<h3>Config File Support</h3>

<p>~/.audio-cli.toml:</p>

<pre><code>[defaults]
jobs = 8
output_format = "json"

[logging]
level = "info"
</code></pre>

<p>코드:</p>

<pre><code">use serde::{Deserialize, Serialize};

#[derive(Serialize, Deserialize)]
struct Config {
    defaults: Defaults,
    logging: Logging,
}

#[derive(Serialize, Deserialize)]
struct Defaults {
    jobs: usize,
    output_format: String,
}

#[derive(Serialize, Deserialize)]
struct Logging {
    level: String,
}

fn load_config() -> anyhow::Result&lt;Config&gt; {
    let config_path = dirs::home_dir()
        .ok_or_else(|| anyhow::anyhow!("Cannot find home directory"))?
        .join(".audio-cli.toml");

    if config_path.exists() {
        let content = std::fs::read_to_string(&amp;config_path)?;
        Ok(toml::from_str(&amp;content)?)
    } else {
        Ok(Config::default())
    }
}
</code></pre>

<h3>Cross-Platform Binary Distribution</h3>

<p>GitHub Actions:</p>

<pre><code>name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    strategy:
      matrix:
        include:
          - os: ubuntu-latest
            target: x86_64-unknown-linux-gnu
            artifact: audio-cli
          - os: macos-latest
            target: x86_64-apple-darwin
            artifact: audio-cli
          - os: macos-latest
            target: aarch64-apple-darwin
            artifact: audio-cli
          - os: windows-latest
            target: x86_64-pc-windows-msvc
            artifact: audio-cli.exe

    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3
      - uses: dtolnay/rust-toolchain@stable
        with:
          targets: ${{ matrix.target }}

      - run: cargo build --target ${{ matrix.target }} --release

      - uses: softprops/action-gh-release@v1
        with:
          files: target/${{ matrix.target }}/release/${{ matrix.artifact }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
</code></pre>

<h3>결론</h3>

<p>Rust CLI 도구는:</p>

<ul>
<li>매우 빠르다 (Python의 100배)</li>
<li>배포가 간단하다 (단일 바이너리)</li>
<li>크로스 플랫폼 지원 (Mac/Windows/Linux)</li>
<li>에러 처리가 안전하다</li>
</ul>

<p>30초 걸리던 Python 스크립트를 0.3초로 만들었다. 이제 일상적으로 쓸 수 있다.</p>


      <div class="author-box">
        <div class="author-avatar">iL</div>
        <div class="author-info">
          <strong>ian.lab</strong>
          <p>28년 경력의 개발자. 실무에서 겪은 문제와 해결 과정을 기록합니다. 오류 제보는 <a href="/contact.html" style="color:var(--accent)">연락처</a>로 보내주세요.</p>
        </div>
      </div>

      <div class="related-posts">
        <h3>관련 글 더 보기</h3>
        <div class="related-list">
        <a class="related-item" href="/posts/post-04.html">
          <span class="ri-cat">Rust</span>
          <span class="ri-title">C++ 개발자가 Rust로 전환하며 배운 것들 — 소유권 시스템의 실체</span>
        </a>
        <a class="related-item" href="/posts/post-58.html">
          <span class="ri-cat">Rust</span>
          <span class="ri-title">Rust 크로스 컴파일 — Windows/macOS/Linux 한 번에 빌드하기</span>
        </a>
        <a class="related-item" href="/posts/post-77.html">
          <span class="ri-cat">Rust</span>
          <span class="ri-title">Rust 테스트 전략 — 단위/통합/문서 테스트 제대로 쓰기</span>
        </a>
        </div>
      </div>
    </article>
</main>

  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-links">
        <a href="/">홈</a>
        <a href="/archive.html">전체 글</a>
        <a href="/about.html">소개</a>
        <a href="/contact.html">연락처</a>
        <a href="/editorial-policy.html">운영 원칙</a>
        <a href="/privacy.html">개인정보처리방침</a>
        <a href="/terms.html">이용약관</a>
      </div>
      <div class="footer-copy">
        &copy; 2026 DevInsight. All rights reserved.<br>
        기술 정보는 실제 사용 환경에 맞게 검토 후 적용하세요.
      </div>
    </div>
  </footer>
</body>
</html>